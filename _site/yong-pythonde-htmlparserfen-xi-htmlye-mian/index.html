
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
<head>
   <meta http-equiv="content-type" content="text/html; charset=utf-8" />
   <title>用python的HTMLParser分析html页面 &larr; </title>
   <meta name="author" content="Xiang Chao" />

   <link rel="start" href="/" />

	
	
	
  	<link rel="alternate" type="application/atom+xml" href="http://feeds.feedburner.com/feedname" title="RSS feed" />
	
	

   <!-- syntax highlighting CSS -->
   <link rel="stylesheet" href="/assets/themes/mark-reid/css/syntax.css" type="text/css" />

   <!-- Homepage CSS -->
   <link rel="stylesheet" href="/assets/themes/mark-reid/css/screen.css" type="text/css" />

</head>
<body id="">
<div id="site">
  
  <div id="header">
    <h1>
    	<a href="/" title="cloudaice wiki">cloudaice wiki</a>
    	<span class="byline">&larr; <a href="/">Xiang Chao</a></span>
    </h1>
    <ul class="nav">
      <li><a class="home" href="/">Home</a></li>
      <li><a  href="/archive.html">Archive</a></li>
      <li><a  href="/pages.html">Pages</a></li>
      <li><a  href="/categories.html">Categories</a></li>
      <li><a  href="/tags.html">Tags</a></li>
      <li><a  href='/picture.html'>Pic</a></li>
    </ul>
  </div>

  
<div id="page">
	
  <h1 class="emphnext">用python的HTMLParser分析html页面</h1>
  <ul class="tag_box inline">
  
  


  
    
  



  </ul>

  <p>python里面有很多实用简单的工具，下面记录一下自己学习使用HTMLParser模块分析抓取的网页的例子:</p>

<!--more-->


<ul>
<li><h3>基本使用模式</h3>

<pre><code>  class classname(HTMLParser):
     def __init__(self):
         '''
         设置自己定义的初始化变量


         '''
         #执行基类的初始化函数
         HTMLParser.__init__(self)
     def handle_starttag(self,tag,attrs):
         '''
         tag表示碰到的标签
         attrs是一个序列，序列中的内容为元组，
         一个元组中有两个元素，分别是该标签的属性和该属性的值
         判断逻辑语句
         '''
     def handle_data(self,data):
         '''
         这里的data为上面tag标签包含的内容
         对内容进行一些处理
         '''
     def handle_endtag(self,tag):
         '''
         这里tag对应的上面那个标签的结束标签
         例如上的标签为&lt;p&gt;，则这里对应的是&lt;/p&gt;
         在这里写一些处理的语句
         '''
     def getresult(self):
         '''
         写一些自己要返回的内容
         '''
  if __name__=="__main__":
      obname=classname()
      obname.feed(html_data)
      obname.getresult()
</code></pre></li>
<li><h3>分析</h3>

<p>在使用HTMLParser模块的时候，基本都是先建立这样一个类，类的名字可以根据自己的应用起，
这个类继承<strong>HTMLParser</strong>类。里面主要写这三个方法：</p>

<ul>
<li><p>handle_starttag</p>

<blockquote><p>这里写你要处理的html标签。例如<br/>
<code>if tag=='td':....</code><br/>
你可以在这里写一些判断语句以及设置一些标记量</p></blockquote></li>
<li><p>handle_data</p>

<blockquote><p>主要做一些对开始的时候铺货的标签的内容做一些处理</p></blockquote></li>
<li><p>handle_endtag</p>

<blockquote><p>这个方法是和 handle_starttag 对应的。因为标准的html页面都是有闭合标签的
在这里可以做一些完成工作</p></blockquote></li>
</ul>
</li>
<li><h3>示例</h3>

<p>下面是一个抓取<code>www.python.org/index.html</code>页面中所有链接内容的程序</p>

<pre><code>  from HTMLParser import HTMLParser
  import urllib
  import sys
  class parselinks(HTMLParser):
      def __init__(self):
          self.data=[]
          self.href=0
          self.linkname=''
          HTMLParser.__init__(self)
      def handle_starttag(self,tag,attrs):
          if tag =='a':
              for name,value in attrs:
                  if name == 'href':
                      self.href=1
      def handle_data(self,data):
          if self.href:
              self.linkname+=data
      def handle_endtag(self,tag):
          if tag=='a':
              self.linkname=''.join(self.linkname.split())
              self.linkname=self.linkname.strip()
              if  self.linkname:
                  self.data.append(self.linkname)
              self.linkname=''
              self.href=0
      def getresult(self):
          for value in self.data:
              print value
  if __name__=="__main__":
      IParser = parselinks()
      IParser.feed(urllib.urlopen("http://www.python.org/index.html").read())
      IParser.getresult()
      IParser.close()
</code></pre></li>
</ul>


<p>下面是程序运行输出结果</p>

<pre><code>    AdvancedSearch
    About
    News
    Documentation
    Download
    下载
    Community
    Foundation
    CoreDevelopment
    Help
    PackageIndex
    QuickLinks(2.7.2)
    Documentation
    WindowsInstaller
    SourceDistribution
    QuickLinks(3.2.2)
    Documentation
    WindowsInstaller
    SourceDistribution
    PythonJobs
    PythonMerchandise
    PythonWiki
    PythonInsiderBlog
    Python2or3?
    HelpMaintainWebsite
    HelpFundPython
    Non-EnglishResources
    PythonReleaseScheduleiCalCalendar
    Python3
    PyPIpackagename
    Results
    Rackspace
    IndustrialLightandMagic
    AstraZeneca
    Honeywell
    andmanyothers
    eWeek
    more...
    WebProgramming
    CGI
    Zope
    Django
    TurboGears
    XML
    Databases
    ODBC
    MySQL
    GUIDevelopment
    wxPython
    tkInter
    PyGtk
    PyQt
    ScientificandNumeric
    Physics
    Education
    pyBiblio
    SoftwareCarpentryCourse
    Networking
    Sockets
    Twisted
    SoftwareDevelopment
    Buildbot
    Trac
    Roundup
    IDEs
    GameDevelopment
    PyGame
    PyKyra
    3DRendering
    more...
    opensourcelicense
    Python2orPython3
    PythonSoftwareFoundation
    PyConconference
    Readmore
    downloadPythonnow
    O'ReillyOpenSourceConvention
    CallforProposals
    BestProgrammingLanguage
    PyConinChina
    IronPython2.7.1
    PyArkansas
    PyGotham
    Python3.2.2
    RSS
    WebsitemaintainedbythePythoncommunity
    hostingbyxs4all
    designbyTimParkin
    PythonSoftwareFoundation
    LegalStatements
</code></pre>


  <address class="signature">
    <a class="author" href="/">Xiang Chao</a> 
    <span class="date">19 February 2012</span>
    <span class="location"></span>
  </address>
  
  <div class="prev-next">
  
    <a href="/use-mongodb-relaxed" class="next" title="mongodb cooks">Next Post &rarr;</a>
  
  
    <a href="/nginx-plus-django" class="prev" title="Nginx + Django">&larr; Earlier Post</a>
  
  </div>
  
</div><!-- End Page -->




  <div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_developer = 1;
    var disqus_shortname = 'cloudaice'; // required: replace example with your forum shortname
    
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>






  
  <div id="footer">
  	<address>
  		<span class="copyright">
  			Content by <a href="/info/site.html">Xiang Chao</a>. Design by 
  			<a href="http://mark.reid.name/">Mark Reid</a>
  			<br/>
  			(<a rel="licence" href="http://creativecommons.org/licenses/by-nc-sa/3.0/">Some rights reserved</a>)			
  		</span>
  		<span class="engine">
  			Powered by <a href="http://github.com/mojombo/jekyll/" title="A static, minimalist CMS">Jekyll</a>
  		</span>
  	</address>
  </div>
  
</div>

<!--[if IE 6]>
<script type="text/javascript"> 
	/*Load jQuery if not already loaded*/ if(typeof jQuery == 'undefined'){ document.write("<script type=\"text/javascript\"   src=\"http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js\"></"+"script>"); var __noconflict = true; } 
	var IE6UPDATE_OPTIONS = {
		icons_path: "http://static.ie6update.com/hosted/ie6update/images/"
	}
</script>
<script type="text/javascript" src="http://static.ie6update.com/hosted/ie6update/ie6update.js"></script>
<![endif]-->

  
<script type="text/javascript">
var _bdhmProtocol = (("https:" == document.location.protocol) ? " https://" : " http://");
document.write(unescape("%3Cscript src='" + _bdhmProtocol + "hm.baidu.com/h.js%3F804602e26e1df25cce6c94d5ac9e555e' type='text/javascript'%3E%3C/script%3E"));
</script>



</body>
</html>

